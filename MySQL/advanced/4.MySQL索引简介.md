# 1.简介
- MySQL官方对索引的定义为：索引(Index)是帮助MySQL高校获取数据的数据结构。可以得到索引的本质：索引是数据结构。
- 除了数据本身之外,数据库还维护着一个满足特定查找算法的数据结构，这些数据结构以某种方式指向数据，这样就可以在这些数据结构的基础上实现高级查找算法,这种数据结构就是索引。
- 一般来说索引本身也很大，不可能全部存储在内存中，因此索引往往以文件形式存储在硬盘上。

# 2.优缺点
## 2.1 优势
- 提高数据检索效率，降低数据库的IO成本
- 通过索引列对数据进行排序，降低数据排序成本，降低了CPU的消耗

## 2.2 劣势
- 索引也是一张表，保存主键和索引字段，并指向实体表的记录,因此也要占用空间
- 提高查询速度同时，却降低更新表的速度。因为更新时不仅要存数据，还要同步索引信息
- 索引只是提高效率的一个因素，并不一定能提升查询速度

# 3.索引分类
- 单值索引 : 索引只包含表的单个列，一个表可以有多个单列索引
- 唯一索引 : 索引列的值必须唯一，但允许有空值
- 复合索引 : 索引中包含表的多个列

> 聚簇索引并不是一种单独的索引类型，而是一种数据存储方式。</br>
> 术语‘聚簇’表示数据行和相邻的键值聚簇的存储在一起。 

聚簇索引的好处： 
- 按照聚簇索引排列顺序，查询显示一定范围数据的时候，由于数据都是紧密相连，数据库不不用从多个数据块中提取数据，所以节省了大量的io操作。 

聚簇索引的限制： 
- 对于mysql数据库目前只有innodb数据引擎支持聚簇索引，而Myisam并不支持聚簇索引。 
- 由于数据物理存储排序方式只能有一种，所以每个Mysql的表只能有一个聚簇索引。一般情况下就是该表的主键。 
- 为了充分利用聚簇索引的聚簇的特性，所以innodb表的主键列尽量选用有序的顺序id，而不建议用无序的id，比如uuid这种。

# 4.操作索引
## 4.1 创建索引
```sql
CREATE [UNIQUE] INDEX  [indexName] ON table_name(column(length));
```
> 如果是CHAR,VARCHAR类型，length可以小于字段实际长度； 如果是BLOB和TEXT类型，必须指定length。

## 4.2 删除索引
```sql
DROP INDEX [indexName] ON table_name;
```

## 4.3 查看索引
```sql
SHOW INDEX FROM table_name\G;
```

## 4.4 ALTER命令
除了上述命令外，还可以使用ALTER命令:
- ALTER TABLE tbl_name ADD PRIMARY KEY (column_list);
该语句添加一个主键，这意味着索引值必须是唯一的，且不能为NULL。 
- ALTER TABLE tbl_name ADD UNIQUE index_name (column_list);
这条语句创建索引的值必须是唯一的（除了NULL外，NULL可能会出现多次）。 
- ALTER TABLE tbl_name ADD INDEX index_name (column_list);
添加普通索引，索引值可出现多次。 
- ALTER TABLE tbl_name ADD FULLTEXT index_name (column_list);
该语句指定了索引为 FULLTEXT ，用于全文索引。 

# 5.索引结构
## 5.1 BTree 原理图
![](https://raw.githubusercontent.com/lujiahao0708/PicRepo/master/blogPic/MySQL/MySQL%E9%AB%98%E7%BA%A7/BTree%E5%8E%9F%E7%90%86%E5%9B%BE.png)
## 5.2 B+Tree 原理图
![](https://raw.githubusercontent.com/lujiahao0708/PicRepo/master/blogPic/MySQL/MySQL%E9%AB%98%E7%BA%A7/B%2BTree%E5%8E%9F%E7%90%86%E5%9B%BE.png)
## 5.3 对比
- B树的关键字和记录是放在一起的，叶子节点可以看作外部节点，不包含任何信息；B+树的非叶子节点中只有关键字和指向下一个节点的索引，记录只放在叶子节点中。 
- 在B树中，越靠近根节点的记录查找时间越快，只要找到关键字即可确定记录的存在；而B+树中每个记录的查找时间基本是一样的，都需要从根节点走到叶子节点，而且在叶子节点中还要再比较关键字。从这个角度看B-树的性能好像要比B+树好，而在实际应用中却是B+树的性能要好些。因为B+树的非叶子节点不存放实际的数据，这样每个节点可容纳的元素个数比B树多，树高比B树小，这样带来的好处是减少磁盘访问次数。尽管B+树找到一个记录所需的比较次数要比B树多，但是一次磁盘访问的时间相当于成百上千次内存比较的时间，因此实际中B+树的性能可能还会好些，而且B+树的叶子节点使用指针连接在一起，方便顺序遍历（例如查看一个目录下的所有文件，一个表中的所有记录等），这也是很多数据库和文件系统使用B+树的缘故。  

> 为什么说B+树比B树更适合实际应用中操作系统的文件索引和数据库索引？

    1.B+树的磁盘读写代价更低
        B+树的内部结点并没有指向关键字具体信息的指针。因此其内部结点相对B 树更小。如果把所有同一内部结点的关键字存放在同一盘块中，那么盘块所能容纳的关键字数量也越多。一次性读入内存中的需要查找的关键字也就越多。相对来说IO读写次数也就降低了
    2.B+树的查询效率更加稳定
        由于非终结点并不是最终指向文件内容的结点，而只是叶子结点中关键字的索引。所以任何关键字的查找必须走一条从根结点到叶子结点的路。所有关键字查询的路径长度相同，导致每一个数据的查询效率相当。 

# 6.需要创建索引的情况
- 主键自动建立唯一索引
- 频繁作为查询的条件的字段应该创建索引
- 查询中与其他表关联的字段，外键关系建立索引
- 频繁更新的字段不适合创建索引，因为每次更新不单单是更新了记录还会更新索引，加重IO负担
- 单值/复合索引的选择问题，复合索引性价比更高
- 查询中排序的字段，排序字段若通过索引去访问将大大提高排序的速度
- 查询中统计或者分组字段

# 7.不需要创建索引的情况
- 表记录太少
- 经常增删改的表或者字段
- Where条件里用不到的字段不创建索引
- 过滤性不好的不适合建立索引

# 7.参考资料
- [MySQL官方文档](https://dev.mysql.com/doc/refman/5.6/en/installing.html)
- [MySQL高级教程-尚硅谷周阳](https://www.bilibili.com/video/av92933956)

## Tips
欢迎收藏和转发，感谢你的支持！(๑•̀ㅂ•́)و✧ 

欢迎关注我的公众号：后端小哥，专注后端开发，希望和你一起进步！

![](https://github.com/lujiahao0708/PicRepo/raw/master/公众号二维码.jpg)